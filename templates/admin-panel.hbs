<div class="fax-bank-admin">
  <header class="admin-header">
    <h2>üè¶ FAX-BANK Admin</h2>
    <p class="system-info">
      System: <strong>{{gameSystem}}</strong>
      {{#if isSupported}}
        <span class="tag success">Supported</span>
      {{else}}
        <span class="tag warning">Custom</span>
      {{/if}}
    </p>
  </header>

  <nav class="admin-tabs">
    <button type="button" class="tab-btn {{#if showBanks}}active{{/if}}" data-tab="banks">
      üè¶ Banks
    </button>
    <button type="button" class="tab-btn {{#if showEconomies}}active{{/if}}" data-tab="economies">
      üèõÔ∏è Economies
    </button>
    <button type="button" class="tab-btn {{#if showAccounts}}active{{/if}}" data-tab="accounts">
      üìã Accounts
    </button>
    <button type="button" class="tab-btn {{#if showHelp}}active{{/if}}" data-tab="help">
      ‚ùì Help
    </button>
  </nav>

  <div class="admin-content">
    
    {{!-- BANKS TAB --}}
    {{#if showBanks}}
    <section class="tab-panel">
      <div class="panel-section">
        <h3>Create New Bank</h3>
        <p class="hint">Banks are where players store their money. Assign an NPC actor that players can double-click to access the bank.</p>
        
        <div class="form-grid">
          <div class="form-field">
            <label>Bank Name</label>
            <input type="text" id="bank-name" placeholder="e.g., Royal Treasury" />
          </div>
          <div class="form-field">
            <label>Economy</label>
            <select id="bank-economy">
              <option value="">Select an economy...</option>
              {{#each economies}}
              <option value="{{this.id}}">{{this.name}}</option>
              {{/each}}
            </select>
          </div>
          <div class="form-field">
            <label>Bank NPC Actor</label>
            <select id="bank-npc">
              <option value="">Select an NPC...</option>
              {{#each availableActors}}
              <option value="{{this.id}}">{{this.name}} ({{this.type}})</option>
              {{/each}}
            </select>
          </div>
        </div>
        
        <button type="button" id="create-bank-btn" class="btn primary">
          <i class="fas fa-plus"></i> Create Bank
        </button>
      </div>

      <div class="panel-section">
        <h3>Existing Banks ({{banks.length}})</h3>
        
        {{#if banks.length}}
          {{#each banks}}
          <div class="item-card bank-item" data-bank-id="{{this.id}}" data-npc-actor-id="{{this.npcActorId}}">
            <div class="item-header">
              <div class="item-title">
                <strong>{{this.name}}</strong>
                <span class="item-subtitle">{{this.economyName}}</span>
              </div>
              <button type="button" class="btn danger small delete-bank-btn" data-bank-id="{{this.id}}" title="Delete Bank">
                <i class="fas fa-trash"></i>
              </button>
            </div>
            
            <div class="item-body">
              <div class="npc-assignment">
                <label>Assigned NPC:</label>
                <select class="bank-npc-select">
                  <option value="">None</option>
                  {{#each ../availableActors}}
                  <option value="{{this.id}}" {{#if (eq this.id ../npcActorId)}}selected{{/if}}>{{this.name}}</option>
                  {{/each}}
                </select>
                <button type="button" class="btn primary small assign-npc-btn" data-bank-id="{{this.id}}" title="Save NPC">
                  <i class="fas fa-save"></i>
                </button>
                {{#if this.npcName}}
                <button type="button" class="btn small view-npc-btn" data-actor-id="{{this.npcActorId}}" title="View NPC">
                  <i class="fas fa-eye"></i>
                </button>
                {{/if}}
              </div>
              {{#if this.npcName}}
              <p class="npc-info">‚úÖ <strong>{{this.npcName}}</strong> is assigned. Double-click token to open bank.</p>
              {{else}}
              <p class="npc-info warning">‚ö†Ô∏è No NPC assigned. Players cannot access this bank!</p>
              {{/if}}
            </div>
          </div>
          {{/each}}
        {{else}}
          <p class="empty-message">
            No banks created yet.<br>
            <small>First create an Economy in the Economies tab, then create a bank here.</small>
          </p>
        {{/if}}
      </div>
    </section>
    {{/if}}

    {{!-- ECONOMIES TAB --}}
    {{#if showEconomies}}
    <section class="tab-panel">
      <div class="panel-section">
        <h3>Create New Economy</h3>
        <p class="hint">Each economy has its own currencies. Create one for each kingdom, faction, or region in your world.</p>
        
        <div class="form-grid">
          <div class="form-field">
            <label>Economy Name</label>
            <input type="text" id="economy-name" placeholder="e.g., Kingdom of Valdris" />
          </div>
          <div class="form-field">
            <label>Description</label>
            <input type="text" id="economy-description" placeholder="e.g., Northern kingdom" />
          </div>
        </div>
        
        <h4>Base Currency</h4>
        <div class="form-grid cols-3">
          <div class="form-field">
            <label>Currency Name</label>
            <input type="text" id="base-currency-name" placeholder="e.g., Gold" />
          </div>
          <div class="form-field">
            <label>Abbreviation</label>
            <input type="text" id="base-currency-abbrev" placeholder="e.g., gp" />
          </div>
          <div class="form-field">
            <label>Symbol</label>
            <input type="text" id="base-currency-symbol" placeholder="e.g., ü™ô" />
          </div>
        </div>
        
        <button type="button" id="create-economy-btn" class="btn primary">
          <i class="fas fa-plus"></i> Create Economy
        </button>
      </div>

      <div class="panel-section">
        <h3>Existing Economies ({{economies.length}})</h3>
        
        {{#if economies.length}}
          {{#each economies}}
          <div class="item-card economy-item" data-economy-id="{{this.id}}">
            <div class="item-header">
              <div class="item-title">
                <strong>{{this.name}}</strong>
                <span class="item-subtitle">{{this.description}}</span>
              </div>
              <button type="button" class="btn danger small delete-economy-btn" data-economy-id="{{this.id}}" title="Delete Economy">
                <i class="fas fa-trash"></i>
              </button>
            </div>
            
            <div class="item-body">
              <h5>Currencies</h5>
              <table class="mini-table">
                <thead>
                  <tr>
                    <th>Symbol</th>
                    <th>Name</th>
                    <th>Abbrev</th>
                    <th>Rate</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  {{#each this.currencies}}
                  <tr>
                    <td>{{this.symbol}}</td>
                    <td>{{this.name}}</td>
                    <td>{{this.abbrev}}</td>
                    <td>{{this.baseValue}}</td>
                    <td>
                      {{#if this.isBase}}
                        <span class="tag gold">Base</span>
                      {{else}}
                        <button type="button" class="btn danger mini remove-currency-btn" 
                                data-economy-id="{{../id}}" data-currency-id="{{this.id}}" title="Remove">
                          <i class="fas fa-times"></i>
                        </button>
                      {{/if}}
                    </td>
                  </tr>
                  {{/each}}
                </tbody>
              </table>
              
              <div class="add-row">
                <input type="text" class="new-currency-name" placeholder="Name" />
                <input type="text" class="new-currency-abbrev" placeholder="Abbrev" />
                <input type="text" class="new-currency-symbol" placeholder="Symbol" />
                <input type="number" class="new-currency-value" placeholder="Rate" step="0.01" min="0.01" />
                <button type="button" class="btn primary small add-currency-btn" data-economy-id="{{this.id}}" title="Add Currency">
                  <i class="fas fa-plus"></i>
                </button>
              </div>
            </div>
          </div>
          {{/each}}
        {{else}}
          <p class="empty-message">
            No economies created yet.<br>
            <small>Create your first economy above to get started.</small>
          </p>
        {{/if}}
      </div>
    </section>
    {{/if}}

    {{!-- ACCOUNTS TAB --}}
    {{#if showAccounts}}
    <section class="tab-panel">
      <div class="panel-section">
        <h3>All Player Accounts ({{accounts.length}})</h3>
        
        {{#if accounts.length}}
          <table class="data-table">
            <thead>
              <tr>
                <th>Owner</th>
                <th>Bank</th>
                <th>Balance</th>
                <th>Transactions</th>
              </tr>
            </thead>
            <tbody>
              {{#each accounts}}
              <tr>
                <td><strong>{{this.ownerName}}</strong></td>
                <td>{{this.bankName}}</td>
                <td>{{this.balanceDisplay}}</td>
                <td>{{this.transactionCount}}</td>
              </tr>
              {{/each}}
            </tbody>
          </table>
        {{else}}
          <p class="empty-message">
            No accounts yet.<br>
            <small>Players create accounts when they interact with Bank NPCs.</small>
          </p>
        {{/if}}
      </div>
    </section>
    {{/if}}

    {{!-- HELP TAB --}}
    {{#if showHelp}}
    <section class="tab-panel">
      <div class="panel-section">
        <h3>Getting Started</h3>
        
        <div class="help-item">
          <h4>Step 1: Create an Economy</h4>
          <p>Go to the <strong>Economies</strong> tab and create an economy with a base currency (like Gold Pieces).</p>
        </div>
        
        <div class="help-item">
          <h4>Step 2: Create a Bank</h4>
          <p>Go to the <strong>Banks</strong> tab. Create a bank and assign an NPC actor to represent the banker.</p>
        </div>
        
        <div class="help-item">
          <h4>Step 3: Place the Bank NPC</h4>
          <p>Drag the assigned NPC onto your scene. This is the "bank teller" that players interact with.</p>
        </div>
        
        <div class="help-item">
          <h4>Step 4: Players Use the Bank</h4>
          <p><strong>Double-click</strong> the Bank NPC token to open the banking interface.</p>
          <p>Players can deposit, withdraw, and manage their money.</p>
        </div>
        
        <div class="help-item">
          <h4>Console Commands</h4>
          <p><code>FAXBANK.openAdmin()</code> ‚Äî Open this admin panel</p>
          <p><code>FAXBANK.openBank('actorId')</code> ‚Äî Open bank for a character</p>
          <p><code>FAXBANK.listBanks()</code> ‚Äî List all banks in console</p>
        </div>
      </div>
    </section>
    {{/if}}

  </div>

  <footer class="admin-footer">
    <button type="button" class="btn refresh-btn">
      <i class="fas fa-sync"></i> Refresh
    </button>
  </footer>
</div>
