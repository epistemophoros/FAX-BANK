<div class="fax-bank-admin">
  <header class="admin-header">
    <h2>üè¶ FAX-BANK Admin</h2>
    <p class="system-info">
      System: <strong>{{gameSystem}}</strong>
      {{#if isSupported}}
        <span class="tag success">‚úÖ Supported</span>
      {{else}}
        <span class="tag warning">‚ö†Ô∏è Custom</span>
      {{/if}}
    </p>
  </header>

  <nav class="admin-tabs">
    <button type="button" class="tab-btn {{#if showBanks}}active{{/if}}" data-tab="banks">
      üè¶ Banks
    </button>
    <button type="button" class="tab-btn {{#if showEconomies}}active{{/if}}" data-tab="economies">
      üèõÔ∏è Economies
    </button>
    <button type="button" class="tab-btn {{#if showAccounts}}active{{/if}}" data-tab="accounts">
      üìã Accounts
    </button>
    <button type="button" class="tab-btn {{#if showHelp}}active{{/if}}" data-tab="help">
      ‚ùì Help
    </button>
  </nav>

  <div class="admin-content">
    
    {{!-- BANKS TAB --}}
    {{#if showBanks}}
    <section class="tab-panel">
      <div class="panel-section">
        <h3>‚ûï Create Bank</h3>
        <p class="hint">Create a bank and assign an NPC. Players double-click that NPC to access the bank.</p>
        
        <div class="form-grid">
          <div class="form-field">
            <label>Bank Name</label>
            <input type="text" id="bank-name" placeholder="Royal Treasury" />
          </div>
          <div class="form-field">
            <label>Economy</label>
            <select id="bank-economy">
              <option value="">-- Select Economy --</option>
              {{#each economies}}
              <option value="{{this.id}}">{{this.name}}</option>
              {{/each}}
            </select>
          </div>
          <div class="form-field">
            <label>Bank NPC (Required)</label>
            <select id="bank-npc">
              <option value="">-- Select NPC --</option>
              {{#each availableActors}}
              <option value="{{this.id}}">{{this.name}} ({{this.type}})</option>
              {{/each}}
            </select>
          </div>
        </div>
        
        <button type="button" id="create-bank-btn" class="btn primary">
          <i class="fas fa-plus"></i> Create Bank
        </button>
      </div>

      <div class="panel-section">
        <h3>üè¶ Your Banks ({{banks.length}})</h3>
        
        {{#if banks.length}}
          {{#each banks}}
          <div class="item-card bank-item" data-bank-id="{{this.id}}" data-npc-actor-id="{{this.npcActorId}}">
            <div class="item-header">
              <div class="item-title">
                <strong>{{this.name}}</strong>
                <span class="item-subtitle">{{this.economyName}}</span>
              </div>
              <button type="button" class="btn danger small delete-bank-btn" data-bank-id="{{this.id}}">
                <i class="fas fa-trash"></i>
              </button>
            </div>
            
            <div class="item-body">
              <div class="npc-assignment">
                <label>NPC:</label>
                <select class="bank-npc-select">
                  <option value="">-- None --</option>
                  {{#each ../availableActors}}
                  <option value="{{this.id}}">{{this.name}}</option>
                  {{/each}}
                </select>
                <button type="button" class="btn primary small assign-npc-btn" data-bank-id="{{this.id}}">
                  <i class="fas fa-save"></i>
                </button>
                {{#if this.npcName}}
                <button type="button" class="btn small view-npc-btn" data-actor-id="{{this.npcActorId}}">
                  <i class="fas fa-eye"></i>
                </button>
                {{/if}}
              </div>
              {{#if this.npcName}}
              <p class="npc-info">‚úÖ <strong>{{this.npcName}}</strong> ‚Äî Double-click this NPC to open bank</p>
              {{else}}
              <p class="npc-info warning">‚ö†Ô∏è No NPC assigned!</p>
              {{/if}}
            </div>
          </div>
          {{/each}}
        {{else}}
          <p class="empty-message">No banks. Create an economy first (Economies tab), then create a bank here.</p>
        {{/if}}
      </div>
    </section>
    {{/if}}

    {{!-- ECONOMIES TAB --}}
    {{#if showEconomies}}
    <section class="tab-panel">
      <div class="panel-section">
        <h3>‚ûï Create Economy</h3>
        <p class="hint">Economies have their own currencies. Create one before making banks.</p>
        
        <div class="form-grid">
          <div class="form-field">
            <label>Name</label>
            <input type="text" id="economy-name" placeholder="Kingdom of Valdris" />
          </div>
          <div class="form-field">
            <label>Description</label>
            <input type="text" id="economy-description" placeholder="Northern kingdom" />
          </div>
        </div>
        
        <h4>Base Currency</h4>
        <div class="form-grid cols-3">
          <div class="form-field">
            <label>Name</label>
            <input type="text" id="base-currency-name" placeholder="Gold" />
          </div>
          <div class="form-field">
            <label>Abbrev</label>
            <input type="text" id="base-currency-abbrev" placeholder="gp" />
          </div>
          <div class="form-field">
            <label>Symbol</label>
            <input type="text" id="base-currency-symbol" placeholder="ü™ô" />
          </div>
        </div>
        
        <button type="button" id="create-economy-btn" class="btn primary">
          <i class="fas fa-plus"></i> Create Economy
        </button>
      </div>

      <div class="panel-section">
        <h3>üìú Economies ({{economies.length}})</h3>
        
        {{#if economies.length}}
          {{#each economies}}
          <div class="item-card economy-item" data-economy-id="{{this.id}}">
            <div class="item-header">
              <div class="item-title">
                <strong>{{this.name}}</strong>
                <span class="item-subtitle">{{this.description}}</span>
              </div>
              <button type="button" class="btn danger small delete-economy-btn" data-economy-id="{{this.id}}">
                <i class="fas fa-trash"></i>
              </button>
            </div>
            
            <div class="item-body">
              <h5>üí∞ Currencies</h5>
              <table class="mini-table">
                <thead>
                  <tr><th>Symbol</th><th>Name</th><th>Abbrev</th><th>Rate</th><th></th></tr>
                </thead>
                <tbody>
                  {{#each this.currencies}}
                  <tr>
                    <td>{{this.symbol}}</td>
                    <td>{{this.name}}</td>
                    <td>{{this.abbrev}}</td>
                    <td>{{this.baseValue}}</td>
                    <td>
                      {{#if this.isBase}}
                        <span class="tag gold">BASE</span>
                      {{else}}
                        <button type="button" class="btn danger mini remove-currency-btn" 
                                data-economy-id="{{../id}}" data-currency-id="{{this.id}}">
                          <i class="fas fa-times"></i>
                        </button>
                      {{/if}}
                    </td>
                  </tr>
                  {{/each}}
                </tbody>
              </table>
              
              <div class="add-row">
                <input type="text" class="new-currency-name" placeholder="Name" />
                <input type="text" class="new-currency-abbrev" placeholder="Abbrev" />
                <input type="text" class="new-currency-symbol" placeholder="Symbol" />
                <input type="number" class="new-currency-value" placeholder="Rate" step="0.01" min="0.01" />
                <button type="button" class="btn primary small add-currency-btn" data-economy-id="{{this.id}}">
                  <i class="fas fa-plus"></i>
                </button>
              </div>
            </div>
          </div>
          {{/each}}
        {{else}}
          <p class="empty-message">No economies yet.</p>
        {{/if}}
      </div>
    </section>
    {{/if}}

    {{!-- ACCOUNTS TAB --}}
    {{#if showAccounts}}
    <section class="tab-panel">
      <div class="panel-section">
        <h3>üìã All Accounts ({{accounts.length}})</h3>
        
        {{#if accounts.length}}
          <table class="data-table">
            <thead>
              <tr><th>Owner</th><th>Bank</th><th>Balance</th><th>Txns</th></tr>
            </thead>
            <tbody>
              {{#each accounts}}
              <tr>
                <td><strong>{{this.ownerName}}</strong></td>
                <td>{{this.bankName}}</td>
                <td>{{this.balanceDisplay}}</td>
                <td>{{this.transactionCount}}</td>
              </tr>
              {{/each}}
            </tbody>
          </table>
        {{else}}
          <p class="empty-message">No accounts yet.</p>
        {{/if}}
      </div>
    </section>
    {{/if}}

    {{!-- HELP TAB --}}
    {{#if showHelp}}
    <section class="tab-panel">
      <div class="panel-section">
        <h3>üìñ How It Works</h3>
        
        <div class="help-item">
          <h4>1. Create Economy</h4>
          <p>Go to Economies tab. Create an economy with a base currency (e.g., Gold).</p>
        </div>
        
        <div class="help-item">
          <h4>2. Create Bank + Assign NPC</h4>
          <p>Go to Banks tab. Create a bank and assign an NPC actor to it.</p>
        </div>
        
        <div class="help-item">
          <h4>3. Place NPC Token</h4>
          <p>Place the NPC on the scene. This is the "bank teller".</p>
        </div>
        
        <div class="help-item">
          <h4>4. Players Use Bank</h4>
          <p><strong>Double-click</strong> the Bank NPC token ‚Üí Bank dialog opens.</p>
          <p>Players can deposit, withdraw, and transfer money.</p>
        </div>
        
        <div class="help-item">
          <h4>Console Commands</h4>
          <p><code>FAXBANK.openAdmin()</code></p>
          <p><code>FAXBANK.openBank('actorId')</code></p>
          <p><code>FAXBANK.listBanks()</code></p>
        </div>
      </div>
    </section>
    {{/if}}

  </div>

  <footer class="admin-footer">
    <button type="button" class="btn refresh-btn">
      <i class="fas fa-sync"></i> Refresh
    </button>
  </footer>
</div>
