<div class="fax-bank-admin">
  <header class="admin-header">
    <h2>üè¶ FAX-BANK Administration</h2>
    <p class="system-info">
      Game System: <strong>{{gameSystem}}</strong>
      {{#if isSupported}}
        <span class="tag success">‚úÖ Full Support</span>
      {{else}}
        <span class="tag warning">‚ö†Ô∏è Custom Mode</span>
      {{/if}}
    </p>
  </header>

  <nav class="admin-tabs">
    <button type="button" class="tab-btn {{#if showEconomies}}active{{/if}}" data-tab="economies">
      üèõÔ∏è Economies
    </button>
    <button type="button" class="tab-btn {{#if showBanks}}active{{/if}}" data-tab="banks">
      üè¶ Banks
    </button>
    <button type="button" class="tab-btn {{#if showAccounts}}active{{/if}}" data-tab="accounts">
      üìã Accounts
    </button>
    <button type="button" class="tab-btn {{#if showHelp}}active{{/if}}" data-tab="help">
      ‚ùì Help
    </button>
  </nav>

  <div class="admin-content">
    
    {{!-- ECONOMIES TAB --}}
    {{#if showEconomies}}
    <section class="tab-panel">
      <div class="panel-section">
        <h3>‚ûï Create New Economy</h3>
        <p class="hint">Economies represent kingdoms, factions, or regions with their own currencies.</p>
        
        <div class="form-grid">
          <div class="form-field">
            <label>Economy Name</label>
            <input type="text" id="economy-name" placeholder="Kingdom of Valdris" />
          </div>
          <div class="form-field">
            <label>Description</label>
            <input type="text" id="economy-description" placeholder="The northern kingdom" />
          </div>
        </div>
        
        <h4>Base Currency</h4>
        <div class="form-grid cols-3">
          <div class="form-field">
            <label>Name</label>
            <input type="text" id="base-currency-name" placeholder="Gold" />
          </div>
          <div class="form-field">
            <label>Abbreviation</label>
            <input type="text" id="base-currency-abbrev" placeholder="gp" />
          </div>
          <div class="form-field">
            <label>Symbol</label>
            <input type="text" id="base-currency-symbol" placeholder="ü™ô" />
          </div>
        </div>
        
        <button type="button" id="create-economy-btn" class="btn primary">
          <i class="fas fa-plus"></i> Create Economy
        </button>
      </div>

      <div class="panel-section">
        <h3>üìú Existing Economies ({{economies.length}})</h3>
        
        {{#if economies.length}}
          {{#each economies}}
          <div class="item-card economy-item" data-economy-id="{{this.id}}">
            <div class="item-header">
              <div class="item-title">
                <strong>{{this.name}}</strong>
                <span class="item-subtitle">{{this.description}}</span>
              </div>
              <button type="button" class="btn danger small delete-economy-btn" data-economy-id="{{this.id}}" title="Delete Economy">
                <i class="fas fa-trash"></i>
              </button>
            </div>
            
            <div class="item-body">
              <h5>üí∞ Currencies</h5>
              <table class="mini-table">
                <thead>
                  <tr>
                    <th>Symbol</th>
                    <th>Name</th>
                    <th>Abbrev</th>
                    <th>Rate</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody>
                  {{#each this.currencies}}
                  <tr>
                    <td>{{this.symbol}}</td>
                    <td>{{this.name}}</td>
                    <td>{{this.abbrev}}</td>
                    <td>{{this.baseValue}}</td>
                    <td>
                      {{#if this.isBase}}
                        <span class="tag gold">BASE</span>
                      {{else}}
                        <button type="button" class="btn danger mini remove-currency-btn" 
                                data-economy-id="{{../id}}" data-currency-id="{{this.id}}" title="Remove">
                          <i class="fas fa-times"></i>
                        </button>
                      {{/if}}
                    </td>
                  </tr>
                  {{/each}}
                </tbody>
              </table>
              
              <div class="add-row">
                <input type="text" class="new-currency-name" placeholder="Name" />
                <input type="text" class="new-currency-abbrev" placeholder="Abbrev" />
                <input type="text" class="new-currency-symbol" placeholder="Symbol" />
                <input type="number" class="new-currency-value" placeholder="Rate" step="0.01" min="0.01" />
                <button type="button" class="btn primary small add-currency-btn" data-economy-id="{{this.id}}">
                  <i class="fas fa-plus"></i> Add
                </button>
              </div>
            </div>
          </div>
          {{/each}}
        {{else}}
          <p class="empty-message">No economies yet. Create one above!</p>
        {{/if}}
      </div>
    </section>
    {{/if}}

    {{!-- BANKS TAB --}}
    {{#if showBanks}}
    <section class="tab-panel">
      <div class="panel-section">
        <h3>‚ûï Create New Bank</h3>
        <p class="hint">Banks belong to economies. Assign an NPC to let players interact with it.</p>
        
        <div class="form-grid">
          <div class="form-field">
            <label>Bank Name</label>
            <input type="text" id="bank-name" placeholder="Royal Treasury" />
          </div>
          <div class="form-field">
            <label>Economy</label>
            <select id="bank-economy">
              <option value="">-- Select Economy --</option>
              {{#each economies}}
              <option value="{{this.id}}">{{this.name}}</option>
              {{/each}}
            </select>
          </div>
          <div class="form-field">
            <label>Bank NPC (optional)</label>
            <select id="bank-npc">
              <option value="">-- No NPC --</option>
              {{#each availableActors}}
              <option value="{{this.id}}">{{this.name}} ({{this.type}})</option>
              {{/each}}
            </select>
          </div>
        </div>
        
        <button type="button" id="create-bank-btn" class="btn primary">
          <i class="fas fa-plus"></i> Create Bank
        </button>
      </div>

      <div class="panel-section">
        <h3>üè¶ Existing Banks ({{banks.length}})</h3>
        
        {{#if banks.length}}
          {{#each banks}}
          <div class="item-card bank-item" data-bank-id="{{this.id}}" data-npc-actor-id="{{this.npcActorId}}">
            <div class="item-header">
              <div class="item-title">
                <strong>{{this.name}}</strong>
                <span class="item-subtitle">Economy: {{this.economyName}}</span>
              </div>
              <button type="button" class="btn danger small delete-bank-btn" data-bank-id="{{this.id}}" title="Delete Bank">
                <i class="fas fa-trash"></i>
              </button>
            </div>
            
            <div class="item-body">
              <div class="npc-assignment">
                <label>Assigned NPC:</label>
                <select class="bank-npc-select">
                  <option value="">-- No NPC --</option>
                  {{#each ../availableActors}}
                  <option value="{{this.id}}">{{this.name}}</option>
                  {{/each}}
                </select>
                <button type="button" class="btn primary small assign-npc-btn" data-bank-id="{{this.id}}">
                  <i class="fas fa-save"></i> Save
                </button>
                {{#if this.npcName}}
                <button type="button" class="btn small view-npc-btn" data-actor-id="{{this.npcActorId}}" title="View NPC Sheet">
                  <i class="fas fa-eye"></i>
                </button>
                {{/if}}
              </div>
              {{#if this.npcName}}
              <p class="npc-info">‚úÖ Current NPC: <strong>{{this.npcName}}</strong></p>
              {{else}}
              <p class="npc-info warning">‚ö†Ô∏è No NPC assigned. Players won't be able to access this bank via NPC interaction.</p>
              {{/if}}
            </div>
          </div>
          {{/each}}
        {{else}}
          <p class="empty-message">No banks yet. Create an economy first, then add banks!</p>
        {{/if}}
      </div>
    </section>
    {{/if}}

    {{!-- ACCOUNTS TAB --}}
    {{#if showAccounts}}
    <section class="tab-panel">
      <div class="panel-section">
        <h3>üìã All Bank Accounts ({{accounts.length}})</h3>
        <p class="hint">View all player accounts across all banks. Accounts are created when players deposit funds.</p>
        
        {{#if accounts.length}}
          <table class="data-table">
            <thead>
              <tr>
                <th>Owner</th>
                <th>Bank</th>
                <th>Economy</th>
                <th>Balance</th>
                <th>Transactions</th>
              </tr>
            </thead>
            <tbody>
              {{#each accounts}}
              <tr>
                <td><strong>{{this.ownerName}}</strong></td>
                <td>{{this.bankName}}</td>
                <td>{{this.economyName}}</td>
                <td>{{this.balanceDisplay}}</td>
                <td>{{this.transactionCount}}</td>
              </tr>
              {{/each}}
            </tbody>
          </table>
        {{else}}
          <p class="empty-message">No accounts yet. Players will create accounts when they deposit funds at a bank.</p>
        {{/if}}
      </div>
    </section>
    {{/if}}

    {{!-- HELP TAB --}}
    {{#if showHelp}}
    <section class="tab-panel">
      <div class="panel-section">
        <h3>üìñ How FAX-BANK Works</h3>
        
        <div class="help-item">
          <h4>üèõÔ∏è Step 1: Create an Economy</h4>
          <p>Economies represent monetary systems for kingdoms, factions, or regions. Each economy has its own set of currencies with exchange rates.</p>
        </div>
        
        <div class="help-item">
          <h4>üí∞ Step 2: Add Currencies</h4>
          <p>The base currency has a rate of 1. Additional currencies have rates relative to the base (e.g., Silver = 0.1 means 10 Silver = 1 Gold).</p>
        </div>
        
        <div class="help-item">
          <h4>üè¶ Step 3: Create Banks</h4>
          <p>Banks belong to economies and hold player accounts. Create at least one bank for each economy.</p>
        </div>
        
        <div class="help-item">
          <h4>üë§ Step 4: Assign Bank NPCs</h4>
          <p>Assign an Actor (typically an NPC) to represent the bank. When players open that NPC's character sheet, they'll see a button to access the bank.</p>
        </div>
        
        <div class="help-item">
          <h4>üíµ Step 5: Players Use Banks</h4>
          <p>Players can:</p>
          <ul>
            <li>Open Bank NPC sheets to access banking</li>
            <li>Use the Token HUD bank button (right-click token)</li>
            <li>Deposit/withdraw currency (syncs with character sheet for dnd5e/pf2e)</li>
            <li>Transfer funds to other characters</li>
          </ul>
        </div>
        
        <div class="help-item">
          <h4>üîß Console Commands</h4>
          <p><code>FAXBANK.openAdmin()</code> - Open this panel</p>
          <p><code>FAXBANK.openBank(actorId)</code> - Open bank dialog for an actor</p>
        </div>
      </div>
    </section>
    {{/if}}

  </div>

  <footer class="admin-footer">
    <button type="button" class="btn refresh-btn">
      <i class="fas fa-sync"></i> Refresh
    </button>
  </footer>
</div>
